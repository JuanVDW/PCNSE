# Decryption

### Decryption Concepts
* Encrypted traffic is growing every year
* PAN's can decrypt SSHv2 and SSL/TLS inbound and outbound traffic
* SSL Establishment includes:
    * Client: requests SSL connection
    * Server: sends server public cert
    * Client: cerifies Cert
    * Client: sends encrypted session key
    * Server: begins encrypted communications session
* When an SSL session is first established or needs to re-establish a session and rekey, this is known as PFS (Perfect Forward Secrecy)
* The FW can act as an Outbound SSL Proxy:
    * A client initiates a session to an external server
    * The FW intercepts the connection, decrypts it, applies any security policies, re-encrypts the traffic and sends to the external server
* The FW can perform Inbound SSL decryption (does not act as a proxy, just decrypts and inspects)
    * The internal server's certificate and private key need to be added to the PAN firewall for this to function properly
* The FW can perform SSHv2 Proxy for both inbound and outbound SSH traffic
    * If SSH Tunneling of another application is found, the session is blocked to prevent apps from bypassing firewall rules.
* Public Key Infrastructure (PKI) solves issue of secure identification of public keys
    * Uses digital certificates to verify public key owners (x.509 format)
    * Typical PKI components include:
      * Root CA: Provides service that confirm identity and public keys to people and companies
      * Intermediate CA: Certified by a Root CA, and will issue certificates; has a DB that will issue, revoke certs and stores CSR's
      * Device has the certificate and private keys. They maintain a list of trusted CA's, and can be updated by admins or by system updates.
    * Certificate chain starts with the device and ends with the Root CA. As long as there is a Root CA in the chain, the certificate can be checked as valid (or revoked).
    * Certificate Hashes can be validated to confirm that it hasn't been intercepted and altered
* Firewalls can use for many purposes:
    * SSL/TLS
    * MGT Interface User Auth
    * Global Protect: Portal Auth, Gateway Auth, Mobile Security Manager Auth
    * Captive Portal User Auth
    * IPSec VPN IKE Auth
    * HA Auth
    * Secure Syslog Auth
* All Certificates in a chain must be checked and validated before an SSL session is permitted
* Checking a Certificate includes:
    * Is the signature valid
    * Is the date range valid
    * is it intact/not malformed?
    * Has the certificate been revoked?
      * CRL (certificate revocation list) has a list of revoked certificates
      * OCSP (online cert status protocol) can check revocation status
      * Certs can be revoked for: Private key compromised, Hostname/username changed, counterfeit key found
* Certificate signing request (CSR) is generated by the device. This is used by a certificate issuing authority to generate the device. The private key generated with this CSR never leaves the device.
